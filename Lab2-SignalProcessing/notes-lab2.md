## Exercise 1: Check that Matlab on your computer is talking to PyBench hardware

**Issues:** Took some time to recognise PyBench. Try restarting MATLAB a few times if it happens again. <br />

**Notes on serial ports:** 
- The name "serial" comes from the fact that a serial port "serializes" data. This means it takes a byte of data and transmits the 8 bits in the byte one at a time.
- The advantage of this is that a serial port only needs one wire to transmit 8 bits. 
- Disadvantage is that takes 8 times longer to transmit than using 8 wires. 
- Lower cable costs.
- Make cables smaller.
- Before each byte of data, a serial port sends a start bit, which is a single bit with a value of 0.
- After each byte of data, it sends a stop bit to signal the byte is complete.
- May also send a parity bit which helps confirm the information sent is correct.
- Also called _communication ports_ (hence the labelling "COM"). 
- Rely on a _Universal Asynchronoush Receiver/ Transmitter (UART)_ chip. This is what takes the parallel output of the computer's system bus and transforms it into serial form. 
- Appearance: A serial port is male in gender, and has either 9 pins or 25 pins. The shape of the port is slightly D-shaped. Only very old computers have a 25-pin serial port.
<br />

<img src="serial_port.jpg" alt="Serial port"/>

**Notes on parallel ports:** 
- Quicker than a serial port as has 8 times as many wires.
- Needs 8 wires to transmit 8 bits.
- Appearance: A parallel port is female in gender, and has 25 pins. The shape of the port is slightly D-shaped. On most computers, there is only one parallel port.
<br />

<img src="parallel_port.jpg" alt="Parallel port"/>

**Notes on USB ports:** 
- Will likely take over both serial and parallel ports.
- Short for _Universal Serial Bus_.
- The main advantage of USB is that the device can be plugged in or plugged out without the need of restarting the PC.
- Contains 4 pathways: _Vbus_ and _Gnd_ provide power to the USB device meanwhile _Data +_ and _Data -_ transfer data.
- This type of port gives you a single, standardized and easy-to-use method of connecting up to 127 different devices to a computer. 
- _A_ connectors head "upstream" toward the computer.
- _B_ connectors head "downstream" and connect to individual devices.
- These different connectors mean it's impossible to get confused about which way to connect.
- _Enumeration_ occurs when the host powers up. It is when the host queries all the devices connected to the bus and assigns each one an address. It also finds out what type of data each device wishes to transfer:
    - An _interrupt_ is a device such as a mouse which sends very little data.
    - A _bulk_ device is one like a printer which receives data in one big packet. A block of data is sent to the printer (in 64-byte chunks) and verified to make sure it's correct.
    - An _isochronous_ device is one like a speaker which streams between the device and the host in real-time and there is no error correction. 
- A USB 2.0 cable has 4 wires in total. The USB 3.0 standard _adds_ four more wires for data transmission. While USB 2.0 can only send data in one direction at a time (downstream or upstream), USB 3.0 can transmit data in both directions simultaneously.
- 
<br />

<img src="USB-AB-CONNECTORS.png" alt="USB A vs USB B"/>

<img src="inside_usb.jpg" alt="Inside a USB cable."/>

**Sources:** https://computer.howstuffworks.com/serial-port.htm#:~:text=Before%20each%20byte%20of%20data,ports%2C%20are%20bi%2Ddirectional. <br />

https://kb.laplink.com/index.php/article/printer/117 <br />

https://www.electroschematics.com/usb-how-things-work/ <br />

https://computer.howstuffworks.com/usb.htm




## Exercise 2: Using PyBench to generate signals via Matlab and explore their spectra

**Files:** lab2task2.m <br />

**What:**  <br />

1. Checking that a 440Hz sinewave, triangular wave and square wave are generated by the PyBench board on the analogue output pin a_out.<br />

2. Changing the inputed amplitude and frequency for the waveforms.

**Notes:** Task 1 seemed to take a very long time to get up and running. Errors kept appearing on MATLAB. Suddenly, (after 4.5 hours of trying), it worked after seemingly changing nothing! This is because Peter had uploaded a new version of the PyBenchfile during the time I was trying to fix it. <br /> Once all the equipment was working, the results could be looked at in more detail. Changing the frequency and voltage of the wave had the obvious result of changing the period and amplitude of the waveform (the results can be seen in image ex2_square2.jpg where the max_v was set to 1.0 V and signal frequency set to 200 Hz). <br /> The following morning, a new issue arose. What once produces a sine wave was now producing a very strange waveform. The solution was a new module (sent by Peter) as, somehow, something had broken within the A/D converter. 


**NB: This is for testing the output using PUTTY** <br /> 
F4400 <br /> 
A8000 <br /> 
X3723 <br /> 
N620 <br /> 
D50 <br /> 
S <br /> 

<img src="ex2_sine.jpeg" alt="Sine wave" width="500"/> <nobr>
<img src="ex2_triangle.jpeg" alt="Triangle wave" width="500"/> 
<img src="ex2_square.jpeg" alt="Square wave" width="500"/> <nobr>
<img src="weird-sine-wave.jpeg" alt="Weird wave" width="500"/>

**Explanation:** The highest peak of the frequency spectrum is at the fundamental frequency and there are additional peaks at harmonic frequencies which can be found using Fourier Series. <br /> 

For a triangular wave, amplitude drops off in proportion to frequency squared.For a square wave, amplitude drops in proportion to frequency. <br /> 

The frequency spectrum of these signals could also be found by finding the Fourier transform of a one pulse of the signal. This single pulse is convoluted with a train of pulses to make it periodic.

<img src="lab2task2_square.png" alt="Square wave"/>
<img src="lab2task2_triangle.png" alt="Triangle wave"/>

## Exercise 3: Capture and analyse microphone signals

**Files for task3:** lab2task3.m <br />

**Changing the sampling frequency:** tunning fork aliased.png <br />

**Changing the number of samples results:**  500a.png, 500b.png, 1000a.png, 1000b.png, 2000a.png, 2000b.png (NB: files with an _a_ are the frequency spectrums and files with a _b_ are the sample number vs voltage plots) <br />

**Files for task3a:** lab2task3a.m, 3000Hz.mov, 3500Hz.mov, 4000Hz.mov, 4500Hz.mov, 5000Hz.mov<br />

**What:** task3 was run and a teammate whistled into her microphone which recorded a snapshot of her voice. On the other hand, task3a continously collects data and plots in the spectrum using a while loop. <br />

**Changing frequency:** We changed the sampling frequency to 500 Hz (which is less than 2 times the frequency of the tuning fork wave) to see the effect of aliasing. The resulting frequency spectrum had a peak at 50 Hz instead of the correct frequency of 440 Hz which is due to the fact that the high frequencies have folded back into the spectrum of the discrete time series and appeared as a lower frequency. The result can be seen in the following image. <br />

<img src="tunning fork aliased.png" alt="Aliasing affect"/>

**Changing number of samples:** Increasing the number of samples (N) collected by the microphone improved the precision of the frequency spectrum peak. On the spectrum, this looks like a sharper peak with no curves either side. This effect is due to the fact that increasing the number of samples means that the mean value of the signal is more accurate. The mean value represents the DC offset which we want to remove.  DC offset occurs in the capturing of sound, before it reaches the recorder, and is normally caused by defective or low-quality equipment (more information can be found at: https://en.wikipedia.org/wiki/DC_bias). In conclusion, by increasing the number of samples, we increase the accuracy of the mean of the signal, which increases the accuracy of the DC offset which is removed, so what is left is a more accurate frequency peak. <br />

<img src="whistle freq domain.png" alt="Whistle frequency domain" width="500"/> <nobr>
<img src="whistle time domain.png" alt="Whistle time domain" width="500"/>

300 Hz capturing live video:
![Video](https://github.com/hannahjayneknight/Electronics2/blob/main/Lab2-SignalProcessing/3000Hz.mov)
<br />

500 Hz capturing live video:
![Video](https://github.com/hannahjayneknight/Electronics2/blob/main/Lab2-SignalProcessing/5000Hz.mov)
## Exercise 4: Windowing effect on a signal

**Files task4:** lab2task4.m, /Lab 2 files/plot_spec_dB.m, <br />

**Files task4a:** lab2task4a.m, 4a-440Hz.mov <br />

**What:**  The same measurements were made as task3, except the results were plotted on a logarithmic frequency spectrum where the amplitude was measured in dB (using plot_spec_dB.m rather than plot_spec). <br /> 

Similar to task3, the code was modified by introducing a while loop. Here we apply a window (known as Hamming Window) to the signal before calculating the spectrum. <br />

**The hamming window:**  The graph _task4a hamming window spectrum.png_ shows the signal with the hamming window in red. Introducing the Hamming Window meant that the small amount of noise that existed before was removed, however, a lot of noise still remained. This could be due to the poor quality of the microphone. The improvement in accuracy can also be seen by the sharpness of the peaks increasing when a hamming window is implemented.<br />

**Difference between Hanning and Hamming window:** The difference between them is that the Hanning window touches zero at both ends, removing any discontinuity. The Hamming window stops just shy of zero, meaning that the signal will still have a slight discontinuity.<br />

**Notes:**  Using a log scale provides much higher sensitivity than a linear scale. The plot is also normalized in a way that the maximum frequency component is at 0dB, i.e. all spectral components are relatively scaled to the peak spectral value. Finally, the magnitude axis is limited to 0dB to -60dB.<br />

NB: The signal processing tool box for Matlab was needed to be downloaded for this exercise. <br />

<img src="task4a hamming window spectrum.png" alt="Hamming window spectrum"/>
<br />
Live capturing of a 44o Hz signal using a Hamming window:
![Video](https://github.com/hannahjayneknight/Electronics2/blob/main/Lab2-SignalProcessing/4a-440Hz.mov)

## Exercise 5: Music signal segmentation and analysis

**Files:**  lab2task5.m, drum.fig, drum_energy.fig<br />

**What:**  Firstly, MATLAB plotted the signal for the music file (which consists of sequence of single drum beats). The _buffer()_ method was used (from the signal processing toolbox) to split the sound file into 20 ms intervals. (It does this by splitting into how many samples you want, the sample is 6 seconds long so we wanted 6/ 0.02 samples.) <br /> 

Next, the energy of each 20 ms second interval was calculated and plotted forming the drum_energy.fig. This was calculated using the formula shown.

<img src="energy-of-sound-wave.jpg" alt="Energy of signal formula"/>

The peaks of the energy wave were highlighted.<br />

**Notes:**  <br />

NB: The signal processing tool box for Matlab was needed to be downloaded for this exercise. <br />

<img src="drum.png" alt="Drum beats time domain"/>
<img src="drum_energy.png" alt="Energy of drum beats"/>
